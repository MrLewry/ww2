<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impact of WW2 on Britain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light blue-grey background */
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px; /* More rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .nav-button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #4f46e5; /* Indigo */
            color: white;
            border: none;
            border-radius: 8px; /* Rounded buttons */
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .nav-button:hover {
            background-color: #4338ca; /* Darker indigo */
        }
        .quiz-button {
            padding: 10px 15px;
            margin-top: 20px;
            background-color: #10b981; /* Emerald */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .quiz-button:hover {
            background-color: #059669; /* Darker emerald */
        }
        .back-button {
            padding: 8px 12px;
            margin-top: 20px;
            background-color: #6b7280; /* Gray */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .back-button:hover {
            background-color: #4b5563; /* Darker gray */
        }
        .answer-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #e5e7eb; /* Light gray */
            border: 1px solid #d1d5db;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .answer-button:hover {
            background-color: #d1d5db; /* Slightly darker gray */
        }
        .correct {
            background-color: #a7f3d0; /* Light green */
            border-color: #34d399; /* Green */
        }
        .incorrect {
            background-color: #fecaca; /* Light red */
            border-color: #f87171; /* Red */
        }
        .hidden {
            display: none;
        }
        .topic-image {
            max-width: 100%; /* Make image responsive */
            height: auto;
            margin-bottom: 20px;
            border-radius: 8px; /* Rounded image corners */
        }
         .final-results {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }
         .final-results h2 {
            text-align: center;
            color: #1d4ed8; /* Blue */
         }
         .final-results p {
             text-align: center;
             margin-bottom: 10px;
         }
         .feedback {
             margin-top: 20px;
             padding: 15px;
             background-color: #eff6ff; /* Light blue */
             border: 1px solid #bfdbfe; /* Lighter blue */
             border-radius: 8px;
         }
         #correct-answer-info {
             margin-top: 15px;
             padding: 15px;
             background-color: #f3f4f6; /* Light light gray */
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             color: #4b5563; /* Darker gray text */
         }
    </style>
</head>
<body>
    <div class="container">
        <div id="home-page">
            <header class="header">
                <h1 class="text-3xl font-bold text-gray-800">What was the impact of WW2 on the people of Britain?</h1>
                <p class="text-gray-600 mt-2">Explore the key aspects of how the war changed life in Britain.</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button class="nav-button" data-topic="events">Events Leading to WW2</button>
                <button class="nav-button" data-topic="battle">Battle of Britain</button>
                <button class="nav-button" data-topic="rationing">Rationing</button>
                <button class="nav-button" data-topic="evacuation">Evacuation</button>
                <button class="nav-button" data-topic="women">Women in the War</button>
                <button class="nav-button" data-topic="migration">Migration</button>
            </div>

            <div id="final-results" class="final-results hidden">
                <h2 class="text-2xl font-bold mb-4">Your Final Results!</h2>
                <p id="final-score-text" class="text-xl font-semibold"></p>
                <p id="final-percentage-text" class="text-xl font-semibold"></p>
                <div id="feedback-text" class="feedback text-gray-700"></div>
            </div>
        </div>

        <div id="topic-page" class="hidden">
            <h2 id="topic-title" class="text-2xl font-bold text-gray-800 mb-4"></h2>
            <img id="topic-image" src="" alt="" class="topic-image hidden">
            <div id="topic-content" class="text-gray-700"></div>
            <button id="start-quiz-button" class="quiz-button">Start Quiz</button>
            <button id="back-to-home-button" class="back-button">Back to Topics</button>
        </div>

        <div id="quiz-page" class="hidden">
            <h2 id="quiz-title" class="text-2xl font-bold text-gray-800 mb-4">Quiz: <span id="quiz-topic-title"></span></h2>
             <div id="score-area" class="text-lg font-semibold text-gray-700 mb-4">Score for this quiz: <span id="current-quiz-score">0</span> / <span id="total-quiz-questions"></span> | Total Score: <span id="overall-score">0</span></div>
            <div id="quiz-area">
                <div id="question-area">
                    <p id="question-text" class="text-gray-800 text-lg mb-4"></p>
                    <div id="answer-buttons">
                        </div>
                </div>
                 <div id="quiz-feedback" class="mt-4 text-center font-bold"></div>
                 <div id="correct-answer-info" class="hidden"></div> <button id="next-question-button" class="quiz-button hidden">Next Question</button>
                <button id="back-to-topic-button" class="back-button">Back to Topic</button>
            </div>
        </div>
    </div>

    <script>
        // Define content for each topic
        const topics = {
            events: {
                title: "Events Leading to the Start of WW2",
                imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Treaty+of+Versailles", // Placeholder for Treaty of Versailles
                imageAlt: "Placeholder image representing the Treaty of Versailles",
                content: `
                    <p class="mb-4">World War 2 didn't start out of nowhere. Several important things happened beforehand:</p>
                    <h3 class="text-xl font-semibold mb-2">The Treaty of Versailles</h3>
                    <p class="mb-4">After World War 1 ended in 1918, a peace treaty called the Treaty of Versailles was signed in 1919. It blamed Germany for the war and made them pay a lot of money to other countries and give up land. Many Germans were very unhappy about this, which helped Adolf Hitler and the Nazi party become powerful.</p>
                    <h3 class="text-xl font-semibold mb-2">Hitler's Actions</h3>
                    <p class="mb-4">Adolf Hitler became the leader of Germany and started to ignore the Treaty of Versailles. He built up Germany's army and started taking over countries nearby, like Austria and Czechoslovakia. Other countries hoped that if they let him have some things, he would stop. This was called 'appeasement'.</p>
                     <h3 class="text-xl font-semibold mb-2">Invasion of Poland</h3>
                    <p class="mb-4">The final straw was when Germany invaded Poland on 1st September 1939. Britain and France had promised to protect Poland. Because Germany invaded, Britain and France declared war on Germany on 3rd September 1939. This was the start of World War 2.</p>
                    <h3 class="text-xl font-semibold mb-2">Who was involved?</h3>
                    <p class="mb-4">The main countries fighting against Germany (the Allies) were Britain, France, and later the Soviet Union and the United States. The main countries fighting with Germany (the Axis Powers) were Italy and Japan.</p>
                `,
                quiz: [
                    {
                        question: "What treaty signed after WW1 made many Germans unhappy?",
                        answers: ["Treaty of Paris", "Treaty of Versailles", "Treaty of London", "Treaty of Berlin"],
                        correct: 1,
                        fact: "The Treaty of Versailles made Germany lose land and pay a lot of money to the winning countries, which caused economic problems and anger in Germany."
                    },
                    {
                        question: "What policy did Britain and France try to use with Hitler before the war?",
                        answers: ["Aggression", "Containment", "Appeasement", "Alliance"],
                        correct: 2,
                        fact: "Appeasement meant giving in to some of Hitler's demands, hoping he would be satisfied and avoid a bigger war. It didn't work."
                    },
                     {
                        question: "Which country's invasion by Germany directly led to Britain declaring war?",
                        answers: ["France", "Czechoslovakia", "Austria", "Poland"],
                        correct: 3,
                        fact: "Britain and France had promised to help Poland if Germany invaded, so when Hitler's army marched into Poland, they had to declare war."
                    }
                ]
            },
            battle: {
                title: "The Battle of Britain",
                 imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Spitfire+and+Hurricane", // Placeholder for Battle of Britain planes
                imageAlt: "Placeholder image of WW2 fighter planes",
                content: `
                    <p class="mb-4">After taking over much of Europe, Hitler wanted to invade Britain. But first, he needed to control the skies. The Battle of Britain was a military campaign where the Royal Air Force (RAF) defended the United Kingdom against attacks by Nazi Germany's air force, the Luftwaffe.</p>
                    <h3 class="text-xl font-semibold mb-2">Operation Sea Lion</h3>
                    <p class="mb-4">Hitler's plan to invade Britain was called Operation Sea Lion. To make it happen, the Luftwaffe had to destroy the RAF so German soldiers could cross the English Channel safely.</p>
                    <h3 class="text-xl font-semibold mb-2">Phases of the Battle</h3>
                    <p class="mb-4">The battle had different phases, starting in the summer of 1940. The Luftwaffe first attacked coastal shipping and ports, then moved on to bombing RAF airfields and radar stations. This was a very dangerous time for the RAF pilots.</p>
                    <h3 class="text-xl font-semibold mb-2">The Blitz</h3>
                    <p class="mb-4">When bombing the airfields didn't completely defeat the RAF, the Luftwaffe started bombing British cities, including London. This period of bombing cities is known as the Blitz. The aim was to terrorise the British people and make them want to give up.</p>
                    <h3 class="text-xl font-semibold mb-2">Britain Fights Back</h3>
                    <p class="mb-4">The RAF, with brave pilots from Britain and other countries, fought back hard. They used fighter planes like the Spitfire and Hurricane. Radar technology helped them detect incoming German planes. Despite being outnumbered, the RAF managed to stop the Luftwaffe from gaining control of the air.</p>
                    <h3 class="text-xl font-semibold mb-2">Significance</h3>
                    <p class="mb-4">The Battle of Britain was a major turning point in the war. The RAF's victory meant Hitler could not invade Britain. This was a huge boost for British morale and showed the world that the Nazis could be defeated.</p>
                `,
                quiz: [
                    {
                        question: "What was the name of Nazi Germany's air force?",
                        answers: ["RAF", "Luftwaffe", "Navy", "Army"],
                        correct: 1,
                         fact: "The Luftwaffe was the aerial warfare branch of the German Wehrmacht during World War II."
                    },
                    {
                        question: "What was Hitler's plan to invade Britain called?",
                        answers: ["Operation Overlord", "Operation Barbarossa", "Operation Sea Lion", "Operation Dynamo"],
                        correct: 2,
                        fact: "Operation Sea Lion was the code name for Nazi Germany's planned invasion of the United Kingdom during the Battle of Britain."
                    },
                    {
                        question: "What was the name for the period of intense bombing of British cities?",
                        answers: ["The Great Fire", "The Hurricane", "The Blitz", "The Storm"],
                        correct: 2,
                        fact: "The Blitz lasted from September 1940 to May 1941 and caused huge damage to cities across Britain."
                    }
                ]
            },
            rationing: {
                title: "Rationing",
                 imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Ration+Book", // Placeholder for Ration Book
                imageAlt: "Placeholder image of a WW2 ration book",
                content: `
                    <p class="mb-4">During the war, it was difficult to get enough food and other important supplies because ships bringing them to Britain were often attacked. To make sure everyone got a fair share, the government introduced rationing.</p>
                    <h3 class="text-xl font-semibold mb-2">How Rationing Worked</h3>
                    <p class="mb-4">Every person was given a ration book with coupons. To buy rationed items like sugar, butter, meat, and tea, you had to hand over money AND the right coupons from your ration book. This meant people could only buy a limited amount of these things each week.</p>
                    <h3 class="text-xl font-semibold mb-2">What was Rationed?</h3>
                    <p class="mb-4">Many things were rationed over time, including:</p>
                    <ul class="list-disc list-inside mb-4">
                        <li>Sugar</li>
                        <li>Meat</li>
                        <li>Butter and Margarine</li>
                        <li>Cheese</li>
                        <li>Tea</li>
                        <li>Eggs</li>
                        <li>Sweets (later in the war)</li>
                        <li>Clothes</li>
                        <li>Petrol</li>
                    </ul>
                    <h3 class="text-xl font-semibold mb-2">Impact on Daily Life</h3>
                    <p class="mb-4">Rationing meant people had to be very careful with what they had. They grew their own vegetables in gardens and parks (the "Dig for Victory" campaign) and learned to cook with fewer ingredients. Wasting food was seen as very bad. Rationing made life challenging, but it also encouraged creativity and sharing within communities.</p>
                    <p class="mb-4">Rationing actually lasted for several years *after* the war ended because there were still shortages. Meat rationing didn't end until 1954!</p>
                `,
                quiz: [
                    {
                        question: "What did people use to buy rationed goods?",
                        answers: ["Money only", "Coupons only", "Money and coupons", "Bartering"],
                        correct: 2,
                        fact: "Ration books contained coupons that were torn out by shopkeepers when you bought rationed items, making sure you didn't buy more than your allowance."
                    },
                    {
                        question: "Which of these items was NOT typically rationed?",
                        answers: ["Sugar", "Meat", "Bread", "Tea"],
                        correct: 2,
                        fact: "Bread was not rationed until 1946, after the war ended, due to global shortages."
                    },
                    {
                        question: "What was the campaign encouraging people to grow their own food called?",
                        answers: ["Grow Your Own", "Dig for Victory", "Garden for Britain", "Home Grown"],
                        correct: 1,
                        fact: "The 'Dig for Victory' campaign encouraged people to use gardens, parks, and even roadside verges to grow food and help feed the nation."
                    }
                ]
            },
            evacuation: {
                title: "Evacuation",
                 imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Evacuee+Children", // Placeholder for Evacuee Children
                imageAlt: "Placeholder image of children being evacuated",
                content: `
                    <p class="mb-4">To protect children and vulnerable people from the bombing in cities, the government organised for them to be moved to safer areas, mostly in the countryside. This was called evacuation.</p>
                    <h3 class="text-xl font-semibold mb-2">Who Was Evacuated?</h3>
                    <p class="mb-4">The main groups evacuated were school-age children, children under five with their mothers, pregnant women, and people with disabilities. Around 3.5 million children were evacuated in total during the war.</p>
                    <h3 class="text-xl font-semibold mb-2">The First Wave</h3>
                    <p class="mb-4">The first big evacuation happened very quickly over just three days, from 1st to 3rd September 1939, right at the start of the war. Around 1.5 million people were moved from major cities like London, Manchester, and Cardiff.</p>
                    <h3 class="text-xl font-semibold mb-2">Life as an Evacuee</h3>
                    <p class="mb-4">Evacuees often had to live with 'host families' – strangers who volunteered or were asked to take them in. This was a massive change for the children. They were often homesick, missed their families, and had to adjust to new homes, schools, and ways of life. Some had good experiences, while others were not treated well.</p>
                    <h3 class="text-xl font-semibold mb-2">Propaganda</h3>
                    <p class="mb-4">The government used posters and other propaganda to try and persuade parents that evacuation was the best and safest thing for their children, even though it was a very difficult decision for families to make.</p>
                `,
                quiz: [
                    {
                        question: "Why were people evacuated from cities?",
                        answers: ["To get more food", "To work on farms", "To escape bombing", "To go on holiday"],
                        correct: 2,
                        fact: "Cities were major targets for German bombing raids, so moving people to the countryside was seen as a way to keep them safe."
                    },
                    {
                        question: "Which of these groups was NOT typically evacuated?",
                        answers: ["School-age children", "Soldiers", "Pregnant women", "Children under five with mothers"],
                        correct: 1,
                        fact: "Soldiers were needed to fight the war and defend the country, so they were not evacuated from cities."
                    },
                     {
                        question: "What were the families who took in evacuated children called?",
                        answers: ["Guest families", "Host families", "Foster families", "Billet families"],
                        correct: 1, // Note: While 'billet' was also used, 'host family' is more common in general terms and used in the source material.
                         fact: "Host families opened their homes to provide shelter and care for children who had been moved away from their own families."
                    }
                ]
            },
            women: {
                title: "Women in the War",
                imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Women+in+Factory", // Placeholder for Women in Factory
                imageAlt: "Placeholder image of women working in a factory during WW2",
                content: `
                    <p class="mb-4">Before the war, many women were expected to stay at home and look after the family. But when lots of men joined the armed forces, women were needed to do jobs that men used to do.</p>
                    <h3 class="text-xl font-semibold mb-2">New Job Roles</h3>
                    <p class="mb-4">Women took on a huge variety of jobs to support the war effort. They worked in factories making weapons and ammunition, on farms growing food (the Women's Land Army), as mechanics, ambulance drivers, nurses, and in the armed forces in roles like driving vehicles or operating radar.</p>
                    <p class="mb-4">By 1943, about 90% of single women and 80% of married women were working in the forces, farming, or factories. The number of women in paid jobs rose from over 5 million in 1939 to over 7 million in 1943.</p>
                    <h3 class="text-xl font-semibold mb-2">Challenges</h3>
                    <p class="mb-4">These jobs were often difficult and sometimes dangerous. Women were doing 'men's jobs' but were often paid less than men for the same work. They also still had to manage their homes and families.</p>
                    <h3 class="text-xl font-semibold mb-2">Impact on Women's Lives</h3>
                    <p class="mb-4">Working during the war showed everyone what women were capable of. It challenged old ideas about what women could and couldn't do. This experience was a big step towards greater equality for women in Britain after the war.</p>
                `,
                quiz: [
                    {
                        question: "What was the name of the group of women who worked on farms?",
                        answers: ["Women's Farm Force", "Land Girls", "Women's Land Army", "Farmettes"],
                        correct: 2,
                        fact: "The Women's Land Army members were often called 'Land Girls' and they did vital work on farms to produce food while men were away fighting."
                    },
                    {
                        question: "By 1943, approximately what percentage of single women were working?",
                        answers: ["50%", "70%", "90%", "100%"],
                        correct: 2,
                        fact: "The need for workers was so great that by 1943, almost all single women and most married women were working in jobs supporting the war effort."
                    },
                    {
                        question: "Were women paid the same as men for doing the same jobs during the war?",
                        answers: ["Yes, always", "No, they were paid less", "Sometimes, it depended on the job", "Only if they worked harder"],
                        correct: 1,
                        fact: "Despite doing the same demanding jobs, women were often paid less than men, highlighting the inequality that existed at the time."
                    }
                ]
            },
            migration: {
                title: "Migration",
                 imageUrl: "https://placehold.co/600x200/E5E7EB/333333?text=Kindertransport+or+Windrush", // Placeholder for Migration
                imageAlt: "Placeholder image related to migration during or after WW2",
                content: `
                    <p class="mb-4">World War 2 caused many people to move, both within countries and to different countries. This led to Britain becoming a more diverse place.</p>
                    <h3 class="text-xl font-semibold mb-2">Kindertransport</h3>
                    <p class="mb-4">One important example was the Kindertransport (Children's Transport). This was a rescue effort between 1938 and 1940 that brought thousands of Jewish children from Nazi Germany, Austria, Poland, and Czechoslovakia to safety in Great Britain. These children often travelled alone, without their parents, to escape persecution.</p>
                    <h3 class="text-xl font-semibold mb-2">People from the Caribbean</h3>
                    <p class="mb-4">During and after the war, people also came to Britain from Caribbean countries to help with the war effort and to find work. Many arrived on ships like the HMT Empire Windrush in 1948. These people, known as the Windrush Generation, played a big part in rebuilding Britain after the war and contributed greatly to British society.</p>
                    <h3 class="text-xl font-semibold mb-2">Why Did People Migrate?</h3>
                    <p class="mb-4">People move for many reasons, which can be 'push' factors (reasons to leave their home, like war or lack of jobs) or 'pull' factors (reasons to move to a new place, like safety or better opportunities).</p>
                    <p class="mb-4">The war created many push factors in Europe, forcing people to leave their homes. Britain offered a pull factor of safety for groups like the Kindertransport children and opportunities for work for people from the Caribbean.</p>
                `,
                quiz: [
                    {
                        question: "What was the name of the rescue effort that brought Jewish children to Britain?",
                        answers: ["Operation Safe Haven", "Kindertransport", "Children's Express", "Operation Evacuation"],
                        correct: 1,
                        fact: "The Kindertransport saved around 10,000 children, giving them a chance for a safer life away from Nazi persecution."
                    },
                    {
                        question: "From which ship did many people from the Caribbean arrive in Britain after the war?",
                        answers: ["The Titanic", "The Queen Mary", "HMT Empire Windrush", "The Mayflower"],
                        correct: 2,
                        fact: "The arrival of the HMT Empire Windrush in 1948 is seen as a landmark moment in the history of modern multi-cultural Britain."
                    },
                    {
                        question: "Reasons that make people want to leave their home country are called:",
                        answers: ["Pull factors", "Push factors", "Migration factors", "Travel factors"],
                        correct: 1,
                        fact: "Push factors are like things 'pushing' you away from your home, such as war, poverty, or lack of opportunities."
                    }
                ]
            }
        };

        let currentTopic = null;
        let currentQuizQuestionIndex = 0;
        let currentQuizScore = 0; // Score for the current quiz
        let totalScore = 0; // Score across all quizzes
        let completedTopics = new Set(); // To track completed quizzes
        let totalQuestions = 0; // Total questions across all quizzes

        // Calculate total questions once
        for (const topicKey in topics) {
            if (topics[topicKey].quiz) {
                totalQuestions += topics[topicKey].quiz.length;
            }
        }


        const homePage = document.getElementById('home-page');
        const topicPage = document.getElementById('topic-page');
        const quizPage = document.getElementById('quiz-page');
        const topicTitle = document.getElementById('topic-title');
        const topicImage = document.getElementById('topic-image'); // Get the image element
        const topicContent = document.getElementById('topic-content');
        const startQuizButton = document.getElementById('start-quiz-button');
        const backToHomeButton = document.getElementById('back-to-home-button');

        const quizTitle = document.getElementById('quiz-topic-title');
        const scoreArea = document.getElementById('score-area'); // Get the score area
        const currentQuizScoreSpan = document.getElementById('current-quiz-score'); // Span for current quiz score
        const totalQuizQuestionsSpan = document.getElementById('total-quiz-questions'); // Span for total questions in current quiz
        const overallScoreSpan = document.getElementById('overall-score'); // Span for overall score

        const questionText = document.getElementById('question-text');
        const answerButtonsDiv = document.getElementById('answer-buttons');
        const quizFeedback = document.getElementById('quiz-feedback');
        const correctAnswerInfoDiv = document.getElementById('correct-answer-info'); // Get the new div for additional info
        const nextQuestionButton = document.getElementById('next-question-button');
        const backToTopicButton = document.getElementById('back-to-topic-button');

        const finalResultsDiv = document.getElementById('final-results'); // Final results section
        const finalScoreText = document.getElementById('final-score-text'); // Final score text
        const finalPercentageText = document.getElementById('final-percentage-text'); // Final percentage text
        const feedbackTextDiv = document.getElementById('feedback-text'); // Feedback text area


        // Event listeners for navigation buttons on the home page
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                const topicKey = button.dataset.topic;
                displayTopic(topicKey);
            });
        });

        // Event listener for the "Start Quiz" button
        startQuizButton.addEventListener('click', () => {
            startQuiz(currentTopic);
        });

        // Event listener for the "Back to Topics" button on topic page
        backToHomeButton.addEventListener('click', () => {
            showHomePage();
        });

        // Event listener for the "Back to Topic" button on quiz page
        backToTopicButton.addEventListener('click', () => {
             // If all quizzes are done, go to final results, otherwise back to home
            if (completedTopics.size === Object.keys(topics).length) {
                showFinalResults();
            } else {
                 showHomePage();
            }
        });

        // Event listener for the "Next Question" button
        nextQuestionButton.addEventListener('click', () => {
            currentQuizQuestionIndex++;
            if (currentQuizQuestionIndex < topics[currentTopic].quiz.length) {
                displayQuestion(currentQuizQuestionIndex);
            } else {
                endQuiz();
            }
        });

        // Function to show the home page
        function showHomePage() {
            homePage.classList.remove('hidden');
            topicPage.classList.add('hidden');
            quizPage.classList.add('hidden');
            finalResultsDiv.classList.add('hidden'); // Hide final results
        }

        // Function to display a topic page
        function displayTopic(topicKey) {
            currentTopic = topicKey;
            const topicData = topics[topicKey];

            topicTitle.textContent = topicData.title;
            topicContent.innerHTML = topicData.content;

            // Set and show the image if available
            if (topicData.imageUrl) {
                topicImage.src = topicData.imageUrl;
                topicImage.alt = topicData.imageAlt || ''; // Use provided alt text or empty string
                topicImage.classList.remove('hidden');
            } else {
                topicImage.classList.add('hidden'); // Hide image if no URL
            }

            homePage.classList.add('hidden');
            quizPage.classList.add('hidden');
            topicPage.classList.remove('hidden');
             finalResultsDiv.classList.add('hidden'); // Hide final results


            // Show or hide the quiz button based on whether a quiz exists for the topic
            if (topicData.quiz && topicData.quiz.length > 0) {
                startQuizButton.classList.remove('hidden');
                 // Disable quiz button if quiz for this topic is already completed
                if (completedTopics.has(topicKey)) {
                     startQuizButton.textContent = "Quiz Completed!";
                     startQuizButton.disabled = true;
                } else {
                    startQuizButton.textContent = "Start Quiz";
                    startQuizButton.disabled = false;
                }

            } else {
                startQuizButton.classList.add('hidden');
            }
        }

        // Function to start the quiz for the current topic
        function startQuiz(topicKey) {
            currentTopic = topicKey;
            currentQuizQuestionIndex = 0;
            currentQuizScore = 0; // Reset score for this quiz
            const topicData = topics[topicKey];

            quizTitle.textContent = topicData.title;
            quizFeedback.textContent = ''; // Clear any previous feedback
            correctAnswerInfoDiv.innerHTML = ''; // Clear additional info
            correctAnswerInfoDiv.classList.add('hidden'); // Hide additional info
            nextQuestionButton.classList.add('hidden'); // Hide next button initially
            scoreArea.classList.remove('hidden'); // Show score area
            totalQuizQuestionsSpan.textContent = topicData.quiz.length; // Set total questions for this quiz
            currentQuizScoreSpan.textContent = currentQuizScore; // Update current quiz score display
            overallScoreSpan.textContent = totalScore; // Update overall score display


            topicPage.classList.add('hidden');
            quizPage.classList.remove('hidden');

            displayQuestion(currentQuizQuestionIndex);
        }

        // Function to display a specific quiz question
        function displayQuestion(index) {
            console.log('Attempting to display question index:', index, 'for topic:', currentTopic);
            const quizData = topics[currentTopic].quiz[index];
            console.log('Retrieved quiz data:', quizData);

            if (!quizData) {
                console.error("Error: Could not retrieve quiz data for index", index, "in topic", currentTopic);
                questionText.textContent = "Error loading question.";
                answerButtonsDiv.innerHTML = '';
                correctAnswerInfoDiv.innerHTML = ''; // Clear additional info
                correctAnswerInfoDiv.classList.add('hidden'); // Hide additional info
                return; // Stop execution if data is missing
            }

            questionText.textContent = quizData.question;
            console.log('Question text set:', quizData.question);


            // Clear previous answer buttons and info
            answerButtonsDiv.innerHTML = '';
            quizFeedback.textContent = ''; // Clear feedback for new question
            correctAnswerInfoDiv.innerHTML = ''; // Clear additional info
            correctAnswerInfoDiv.classList.add('hidden'); // Hide additional info
            nextQuestionButton.classList.add('hidden'); // Hide next button

            // Create answer buttons
            if (quizData.answers && Array.isArray(quizData.answers)) {
                 console.log('Creating answer buttons from:', quizData.answers);
                quizData.answers.forEach((answer, i) => {
                    const button = document.createElement('button');
                    button.classList.add('answer-button');
                    button.textContent = answer;
                    button.dataset.index = i;
                    button.addEventListener('click', handleAnswerClick);
                    answerButtonsDiv.appendChild(button);
                });
                 console.log('Answer buttons created.');
            } else {
                 console.error("Error: Answer data is missing or not an array for question", index, "in topic", currentTopic);
                 answerButtonsDiv.innerHTML = '<p>Error loading answers.</p>';
            }
        }

        // Function to handle an answer button click
        function handleAnswerClick(event) {
            const selectedAnswerIndex = parseInt(event.target.dataset.index);
            const currentQuestionData = topics[currentTopic].quiz[currentQuizQuestionIndex];
            const correctAnswerIndex = currentQuestionData.correct;
            const answerButtons = answerButtonsDiv.querySelectorAll('.answer-button');

            // Disable all answer buttons after one is clicked
            answerButtons.forEach(button => {
                button.disabled = true;
            });

            // Check if the answer is correct and provide feedback
            if (selectedAnswerIndex === correctAnswerIndex) {
                quizFeedback.textContent = 'Correct!';
                quizFeedback.classList.remove('text-red-600');
                quizFeedback.classList.add('text-green-600');
                event.target.classList.add('correct');
                currentQuizScore++; // Increment current quiz score
                totalScore++; // Increment total score
                currentQuizScoreSpan.textContent = currentQuizScore; // Update current quiz score display
                overallScoreSpan.textContent = totalScore; // Update overall score display
            } else {
                quizFeedback.textContent = 'Incorrect.'; // Simpler incorrect feedback here
                quizFeedback.classList.remove('text-green-600');
                quizFeedback.classList.add('text-red-600');
                 event.target.classList.add('incorrect');
                 // Highlight the correct answer
                 answerButtons[correctAnswerIndex].classList.add('correct');
            }

            // Display additional information about the correct answer
            const fact = currentQuestionData.fact;
            let infoText = "";
            if (selectedAnswerIndex === correctAnswerIndex) {
                infoText = `Well done, you are correct! Did you know... ${fact}`;
            } else {
                infoText = `Good try! The correct answer was "${currentQuestionData.answers[correctAnswerIndex]}". Did you know... ${fact}`;
            }
            correctAnswerInfoDiv.textContent = infoText;
            correctAnswerInfoDiv.classList.remove('hidden'); // Show the additional info div


            // Show the next question button or finish the quiz
            if (currentQuizQuestionIndex < topics[currentTopic].quiz.length - 1) {
                nextQuestionButton.classList.remove('hidden');
                 nextQuestionButton.textContent = "Next Question"; // Ensure text is correct
            } else {
                 nextQuestionButton.textContent = "Finish Quiz";
                 nextQuestionButton.classList.remove('hidden');
            }
        }

        // Function to end the current quiz
        function endQuiz() {
            // Mark this topic as completed
            completedTopics.add(currentTopic);

            // Display score for the current quiz
            quizFeedback.textContent = `Quiz for ${topics[currentTopic].title} finished! You got ${currentQuizScore} out of ${topics[currentTopic].quiz.length} correct in this quiz.`;
            quizFeedback.classList.remove('text-green-600', 'text-red-600');
            quizFeedback.classList.add('text-gray-800');

            questionText.textContent = ''; // Clear question text
            answerButtonsDiv.innerHTML = ''; // Clear answer buttons
            correctAnswerInfoDiv.innerHTML = ''; // Clear additional info
            correctAnswerInfoDiv.classList.add('hidden'); // Hide additional info
            nextQuestionButton.classList.add('hidden'); // Hide next button
            nextQuestionButton.textContent = "Next Question"; // Reset button text

            // Check if all quizzes are completed
            if (completedTopics.size === Object.keys(topics).length) {
                 // All quizzes done, show final results after a short delay
                 setTimeout(showFinalResults, 1500); // Delay to let them see the last quiz score
            } else {
                // Not all quizzes done, show back to topics button
                 backToTopicButton.classList.remove('hidden');
                 scoreArea.classList.add('hidden'); // Hide score area after quiz ends
            }
        }

        // Function to show the final results page
        function showFinalResults() {
             quizPage.classList.add('hidden');
             homePage.classList.remove('hidden'); // Show home page
             finalResultsDiv.classList.remove('hidden'); // Show final results section

             const percentage = (totalScore / totalQuestions) * 100;
             finalScoreText.textContent = `Your total score is ${totalScore} out of ${totalQuestions}.`;
             finalPercentageText.textContent = `That's ${percentage.toFixed(1)}%!`; // Show percentage with 1 decimal place

             // Generate and display feedback
             let feedback = "";
             if (percentage >= 85) {
                 feedback = "Excellent! You have a fantastic understanding of the impact of WW2 on Britain. You've clearly learned a lot!";
             } else if (percentage >= 70) {
                 feedback = "Very Good! You have a strong understanding of the key impacts of WW2. Review the topics where you felt less confident to improve further.";
             } else if (percentage >= 50) {
                 feedback = "Good Effort! You understand some of the main impacts, but there are areas you could review. Go back and read the topic pages again, especially the ones where you scored lower in the quizzes.";
             } else {
                 feedback = "Keep Learning! Don't worry, history takes time to learn. Reread all the topic pages carefully and try the quizzes again. Focus on understanding the main ideas in each section.";
             }
             feedbackTextDiv.textContent = feedback;

             // Disable all topic buttons on the home page after completion
             document.querySelectorAll('.nav-button').forEach(button => {
                button.disabled = true;
                button.textContent = button.textContent + " (Done)";
             });
        }


        // Initialize by showing the home page
        showHomePage();

    </script>
</body>
</html>
